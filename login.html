// Récupération des blocs flottants
const blockLogin = document.getElementById('blockLogin');
const blockNewPass = document.getElementById('blockNewPass');

// Récupération des boutons du header
const btnLogin = document.getElementById('btnLogin');
const btnNouveauMDP = document.getElementById('btnNouveauMDP');
const validerLogin = document.getElementById('validerLogin');
const validerNewPass = document.getElementById('validerNewPass');

// Fonction pour afficher ou cacher un bloc flottant
function toggleBlock(block) {
    block.style.display = (block.style.display === 'flex') ? 'none' : 'flex';
}

// --- Ouverture bloc login ---
btnLogin.addEventListener('click', () => {
    blockLogin.style.display = 'flex';
    blockNewPass.style.display = 'none';
});

// --- Valider login ---
validerLogin.addEventListener('click', () => {
    const nom = document.getElementById('loginNom').value.trim();
    const code = document.getElementById('loginCode').value;
    if (!nom || !code) {
        alert("Toutes les informations sont requises.");
        return;
    }

    // Stockage local
    localStorage.setItem('userNom', nom);
    localStorage.setItem('userCode', code);

    alert(`Utilisateur "${nom}" connecté !`);
    blockLogin.style.display = 'none';
});

// --- Nouveau mot de passe ---
btnNouveauMDP.addEventListener('click', () => {
    blockLogin.style.display = 'none';
    blockNewPass.style.display = 'flex';
});

// --- Valider nouveau mot de passe ---
validerNewPass.addEventListener('click', () => {
    const oldCode = document.getElementById('oldCode').value;
    const newCode = document.getElementById('newCode').value;
    const confirmCode = document.getElementById('confirmCode').value;

    if (!oldCode || !newCode || !confirmCode) {
        alert("Toutes les informations sont requises.");
        return;
    }

    if (newCode !== confirmCode) {
        alert("Les nouveaux codes ne correspondent pas.");
        return;
    }

    // Mise à jour du code dans local storage
    localStorage.setItem('userCode', newCode);

    alert("Nouveau code enregistré !");
    blockNewPass.style.display = 'none';
});

// --- Raccourcis clavier ---
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        blockLogin.style.display = 'none';
        blockNewPass.style.display = 'none';
    }
    if (e.key === 'Enter') {
        if (blockLogin.style.display === 'flex') validerLogin.click();
        if (blockNewPass.style.display === 'flex') validerNewPass.click();
    }
});

// --- Remplissage automatique depuis local storage au chargement ---
window.addEventListener('load', () => {
    const storedNom = localStorage.getItem('userNom');
    const storedCode = localStorage.getItem('userCode');
    if (storedNom) document.getElementById('loginNom').value = storedNom;
    if (storedCode) document.getElementById('loginCode').value = storedCode;
});
